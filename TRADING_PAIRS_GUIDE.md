# 交易对管理指南

## 概述

交易对管理功能已集成到管理后台，允许管理员通过Web界面管理交易对和生成历史数据。

## 功能说明

### 1. 自动初始化（首次启动）

首次启动后端服务时，系统会自动：
- ✅ 创建15个预设交易对
- ✅ 初始化手续费配置
- ❌ **不再自动生成**历史交易数据和K线数据

### 2. 管理后台功能

访问管理后台的"交易对管理"页面 (`http://localhost:3001/dashboard/pairs`)，可以：

#### 查看交易对
- 查看所有交易对列表
- 查看交易对的基本信息（符号、基础资产、报价资产、价格范围等）
- 查看交易对状态（active/inactive）

#### 创建交易对
点击"添加交易对"按钮，填写以下信息：
- 交易对符号（如：BTC/USDT）
- 基础资产（如：BTC）
- 报价资产（如：USDT）
- 最小价格、最大价格
- 最小数量、最大数量

#### 启用/禁用交易对
- 点击"启用"或"禁用"按钮切换交易对状态
- 禁用的交易对将不在前端显示

#### 生成历史数据

**步骤1：生成交易数据**
- 点击"生成交易数据"按钮
- 系统会在后台生成6-12个月的模拟交易数据
- 每个交易对的活跃度随机
- 过程需要几分钟，后台运行不阻塞界面

**步骤2：生成K线数据**
- 等待交易数据生成完成
- 点击"生成K线数据"按钮
- 系统会基于交易数据生成多个时间周期的K线
- 支持的周期：1m, 5m, 15m, 30m, 1h, 4h, 1d
- 过程需要几分钟，后台运行不阻塞界面

## API接口

### 后端API

```
GET  /api/admin/pairs                    - 获取所有交易对
POST /api/admin/pairs                    - 创建交易对
PUT  /api/admin/pairs/:id/status         - 更新交易对状态
POST /api/admin/pairs/generate-trades    - 生成历史交易数据
POST /api/admin/pairs/generate-klines    - 生成K线数据
```

### 数据库函数

```go
database.SeedTrades()   // 生成历史交易数据
database.SeedKlines()   // 生成K线数据
```

## 使用流程

### 首次部署

1. 启动后端服务
   ```bash
   cd backend
   go run main.go
   ```

2. 访问管理后台
   ```
   http://localhost:3001
   ```

3. 登录管理后台（使用管理员账号）

4. 进入"交易对管理"页面

5. 查看自动创建的15个交易对

6. 点击"生成交易数据"按钮（建议第一次部署时生成）

7. 等待2-5分钟后，点击"生成K线数据"按钮

8. 访问前端查看交易对和K线图表
   ```
   http://localhost:3000
   ```

### 添加新交易对

1. 点击"添加交易对"按钮

2. 填写交易对信息

3. 点击"创建"

4. 新交易对创建成功后，如需历史数据：
   - 可以通过API单独为该交易对生成数据
   - 或者使用全局生成功能

## 注意事项

⚠️ **重要提示：**

1. **生成数据是后台任务**：点击生成按钮后，任务在后台运行，不要重复点击

2. **生成顺序**：必须先生成交易数据，再生成K线数据

3. **性能影响**：生成大量历史数据可能影响系统性能，建议在低峰期执行

4. **数据量**：
   - 交易数据：约1万-5万条记录（取决于月数和活跃度）
   - K线数据：约5万-10万条记录（多个时间周期）

5. **磁盘空间**：确保有足够的磁盘空间存储SQLite数据库

6. **重复生成**：如果已有数据，再次生成会追加新数据，不会覆盖

## 故障排查

### 问题1：生成按钮点击无响应
**解决方案**：
- 检查浏览器控制台错误
- 检查后端日志
- 确认已登录管理后台

### 问题2：生成数据很慢
**原因**：生成6-12个月的历史数据需要时间
**解决方案**：
- 耐心等待，过程在后台运行
- 可以查看后端日志监控进度
- 不要重复点击按钮

### 问题3：K线数据生成失败
**原因**：没有交易数据
**解决方案**：
- 先生成交易数据
- 确认数据库中有trade记录
- 查看后端日志查找具体错误

### 问题4：前端看不到交易对
**原因**：交易对状态为inactive
**解决方案**：
- 在管理后台将交易对状态改为active
- 刷新前端页面

## 技术细节

### 数据生成策略

**交易数据生成：**
- 随机6-12个月时间范围
- 每个代币随机活跃度（1-4笔/小时）
- 白天（8-22点）交易更频繁
- 价格波动在基准价的±30%范围内
- 模拟趋势变化（每30天可能转变）

**K线生成：**
- 基于真实交易数据聚合
- 支持10个时间周期
- 自动计算OHLC（开高低收）
- 累计成交量

### 预设交易对

系统预设15个交易对，分为5个价格区间：

1. **高价区** (>$5,000): TITAN, GENESIS, LUNAR
2. **中高价区** ($1,000-$5,000): ORACLE, QUANTUM, NOVA
3. **中价区** ($100-$1,000): ATLAS, COSMOS, NEXUS
4. **中低价区** ($10-$100): VERTEX, AURORA, ZEPHYR
5. **低价区** ($1-$10): PRISM, PULSE
6. **超低价区** (<$1): ARCANA

## 未来改进

- [ ] 支持单个交易对生成数据
- [ ] 自定义数据生成参数（时间范围、活跃度等）
- [ ] 实时显示生成进度
- [ ] 导入/导出交易对配置
- [ ] 批量操作交易对状态

