# 📦 批量操作指南

## 🎯 两大批量功能

管理后台现在支持两种批量操作，让你轻松管理所有交易对：

1. **🎮 批量设置活跃度** - 一键配置所有币种的活跃度参数
2. **🚀 批量初始化数据** - 一键为所有币种生成历史交易和K线数据

## 📍 功能位置

```
管理后台 → 交易对管理
http://localhost:3001/dashboard/pairs
```

页面右上角三个按钮：
```
┌───────────────────────────────────────────────────┐
│ [🎮 批量设置活跃度] [🚀 批量初始化数据] [添加交易对] │
└───────────────────────────────────────────────────┘
```

---

## 🎮 功能一：批量设置活跃度

### 作用
一键统一配置所有交易对的市场模拟活跃度参数。

### 操作步骤

1. **点击 "🎮 批量设置活跃度" 按钮**

2. **配置四大参数**：

   ```
   📊 活跃度等级 (1-10)
   ┌──────────────────────────────┐
   │ 🐢       🚶       🏃       🚀│
   │ 1  2  3  4  5  6  7  8  9  10│
   │          ●───────────────────│
   └──────────────────────────────┘
   拖动滑块选择

   📈 订单簿深度 (5-30档)
   ┌──────────────┐
   │ [15]         │ → 15买 + 15卖 = 30个订单
   └──────────────┘
   
   ⏱️ 成交频率 (5-60秒)
   ┌──────────────┐
   │ [20]         │ → 实际: 14-26秒
   └──────────────┘
   
   📉 价格波动率 (0.001-0.05)
   ┌──────────────┐
   │ [0.01]       │ → 1.0% 基础波动
   └──────────────┘
   ```

3. **查看预计效果**：
   ```
   💡 预计效果（所有交易对）：
   • 订单簿每 14秒 更新一次
   • 价格分布范围: ±25.0%
   • 成交量波动: 中等
   
   将更新所有启用模拟器的交易对（共 10 个）
   ```

4. **点击"批量设置"按钮**

5. **生效时间**：≤10秒内所有交易对热更新生效 ✅

### 典型场景

#### 场景 1：让所有币都活跃起来（新站点）

```
活跃度等级: 8 🏃
订单簿深度: 18档
成交频率: 12秒
价格波动率: 0.012 (1.2%)

效果：所有交易对都很活跃，适合新站点吸引用户
```

#### 场景 2：统一降低活跃度（测试环境）

```
活跃度等级: 3 🐢
订单簿深度: 10档
成交频率: 40秒
价格波动率: 0.008 (0.8%)

效果：所有交易对都变慢，适合测试和调试
```

#### 场景 3：恢复默认设置

```
活跃度等级: 5 🚶
订单簿深度: 15档
成交频率: 20秒
价格波动率: 0.01 (1.0%)

效果：标准配置，平衡性能和体验
```

### 注意事项

- ✅ 只影响启用了模拟器的交易对
- ✅ 10秒内自动热更新，无需重启
- ✅ 不影响真实用户下单
- ⚠️ 后续可以单独调整某个币种

---

## 🚀 功能二：批量初始化数据

### 作用
一键为所有交易对生成历史交易记录和K线数据。

### 操作步骤

1. **点击 "🚀 批量初始化数据" 按钮**

2. **配置参数**：

   ```
   📅 开始时间
   ┌──────────────┐
   │ 2024-06-01   │ 日期选择器
   └──────────────┘
   
   📅 结束时间
   ┌──────────────┐
   │ 2024-12-31   │ 日期选择器
   └──────────────┘
   
   🔢 建议总数（可选）
   ┌──────────────┐
   │ [留空]       │ 默认：天数 × 3
   └──────────────┘
   时间跨度：214 天 → 约 642 笔/币种
   
   ☑️ [✓] 同时生成K线数据
   ```

3. **查看预计生成**：
   ```
   📊 预计生成：
   • 交易对数量: 10 个
   • 时间范围: 2024-06-01 ~ 2024-12-31
   • 每个币种: 642 笔交易
   • 预计总交易数: 6420 笔
   • 生成K线: 是
   
   ⏱️ 预计耗时：10 × 2-5秒 ≈ 30-50秒（1-1分钟）
   ```

4. **阅读注意事项**：
   ```
   ⚠️ 注意事项：
   • 任务会在后台队列中依次执行，请耐心等待
   • 在任务管理页面可以查看执行进度
   • 建议：6个月数据，每个币种约500-1000笔交易
   • 生成过多数据会影响查询性能，建议适度
   ```

5. **点击"开始批量生成"**

6. **确认弹窗**：
   ```
   确定要为所有交易对批量生成初始化数据吗？
   
   时间范围：2024-06-01 ~ 2024-12-31 (214天)
   交易对数量：10 个
   预计每个币种生成：642 笔交易
   预计总交易数：6420 笔
   生成K线：是
   
   此操作可能需要较长时间，请耐心等待
   
   [取消] [确定]
   ```

7. **查看任务进度**：
   ```
   🚀 批量初始化任务已创建
   交易对数量：10
   任务数量：20
   请在任务管理中查看进度
   
   → 跳转到：管理后台 → 任务管理
   ```

### 参数说明

#### 时间范围

| 时间跨度 | 推荐场景 | 每币种笔数 | 总笔数(10币) |
|---------|---------|-----------|-------------|
| **1个月** | 快速测试 | ~90笔 | ~900笔 |
| **3个月** | 小型项目 | ~270笔 | ~2700笔 |
| **6个月** | 标准配置 | ~540笔 | ~5400笔 ✅ |
| **1年** | 大型项目 | ~1095笔 | ~10950笔 |

#### 建议总数

```
留空（推荐）：
  自动计算 = 天数 × 3
  例：180天 → 540笔/币种

自定义：
  输入具体数字
  例：1000 → 每个币种1000笔交易
```

#### 生成K线

```
☑️ [✓] 推荐开启
  - K线基于交易数据自动生成
  - 前端需要K线才能显示图表
  - 包含 1m, 5m, 15m, 30m, 1h, 4h, 1d 周期
  
☐ [ ] 不生成
  - 仅生成交易记录
  - 需要手动再生成K线
  - 适合分步执行
```

### 典型场景

#### 场景 1：新项目首次初始化

```
开始时间: 6个月前
结束时间: 今天
建议总数: (留空)
生成K线: ✓

预计：每个币种 ~540笔交易，耗时 1-2分钟
```

#### 场景 2：快速测试数据

```
开始时间: 1个月前
结束时间: 今天
建议总数: 100
生成K线: ✓

预计：每个币种 100笔交易，耗时 20-30秒
```

#### 场景 3：生成大量历史数据

```
开始时间: 1年前
结束时间: 今天
建议总数: 2000
生成K线: ✓

预计：每个币种 2000笔交易，耗时 3-5分钟
⚠️  数据量大，查询可能变慢
```

### 查看进度

生成任务提交后，前往：
```
管理后台 → 任务管理
http://localhost:3001/dashboard/tasks
```

看到类似：
```
┌────────────────────────────────────────────────┐
│ 任务ID: xxx-xxx-xxx                             │
│ 类型: 生成交易数据                              │
│ 交易对: PULSE/USDT                              │
│ 状态: ✅ completed                              │
│ 进度: 100%                                      │
│ 创建时间: 2024-12-31 10:00:00                   │
│ 完成时间: 2024-12-31 10:00:03                   │
│ 耗时: 3秒                                       │
├────────────────────────────────────────────────┤
│ 任务ID: xxx-xxx-xxx                             │
│ 类型: 生成K线数据                               │
│ 交易对: PULSE/USDT                              │
│ 状态: 🔄 running                                │
│ 进度: 45%                                       │
│ ...                                             │
└────────────────────────────────────────────────┘
```

---

## 🆚 两个功能对比

| 特性 | 批量设置活跃度 | 批量初始化数据 |
|------|--------------|--------------|
| **作用** | 配置模拟参数 | 生成历史数据 |
| **影响** | 实时市场活跃度 | 历史交易记录 |
| **生效时间** | ≤10秒 | 1-5分钟 |
| **执行方式** | 立即更新数据库 | 后台队列异步 |
| **可重复** | ✅ 随时修改 | ⚠️  重复会叠加数据 |
| **推荐时机** | 随时调整 | 项目启动时一次 |

## 💡 推荐工作流

### 新项目启动

```
第1步：批量初始化数据（一次性）
  → 生成6个月历史数据
  → 等待1-2分钟完成
  → 前端有图表和记录可显示

第2步：批量设置活跃度（可多次调整）
  → 根据需求调整活跃度
  → 10秒内生效
  → 观察前端效果

第3步：微调个别币种
  → 对特定币种单独编辑
  → 例如：让PULSE更活跃
```

### 日常运营

```
定期检查：
  • 观察前端交易活跃度
  • 根据用户反馈调整
  • 使用批量设置快速调整所有币种
  
个别优化：
  • 热门币种 → 提高活跃度
  • 冷门币种 → 降低活跃度
  • 新上币种 → 生成初始数据
```

## 🔍 常见问题

### Q1: 批量设置活跃度会影响哪些币？

**A**: 只影响**启用了模拟器**的交易对。

查看方法：
- 在交易对列表中，"模拟器"列显示"✅"的币种
- 不影响"❌"的币种

### Q2: 批量初始化会覆盖已有数据吗？

**A**: **不会**。新数据会叠加到现有数据上。

注意：
- 如果重复执行相同时间范围，会生成重复数据
- 建议：首次使用，或数据清空后使用

### Q3: 任务队列卡住了怎么办？

**A**: 前往任务管理页面：

```
1. 查看任务状态
2. 如果是 "failed"，点击"重试"
3. 如果是 "running" 超过10分钟，手动取消后重试
4. 检查后端日志：tail -f /root/go/log/exchange_access.log
```

### Q4: 能否只批量操作部分币种？

**A**: 当前版本批量操作是"全部或没有"。

如需部分操作：
- 单独编辑每个币种
- 或者：先批量设置全部，再单独调整例外

未来可能添加：
- 批量选择特定币种
- 按价格区间批量设置

### Q5: 生成的数据质量如何？

**A**: 模拟数据特点：

```
✅ 优点：
  • 价格趋势真实（有涨有跌）
  • 交易时间分布合理（白天多，晚上少）
  • 数量和价格波动符合币种特性
  • K线图表完整（支持所有周期）

⚠️ 局限：
  • 不是真实市场数据
  • 主要用于展示和测试
  • 适合模拟交易环境
```

### Q6: 建议生成多少数据？

**A**: 根据项目类型：

```
测试环境：
  1个月，每币种100笔 → 快速验证

演示项目：
  3个月，每币种300笔 → 足够展示

生产环境：
  6个月，每币种500-1000笔 → 推荐 ✅
  
大型项目：
  1年，每币种1000-2000笔 → 数据丰富
  ⚠️  注意：数据过多可能影响查询性能
```

## 📊 性能参考

### 批量设置活跃度

```
操作时间: <1秒
生效时间: ≤10秒
数据库影响: 极小（只更新配置字段）
前端感知: 10秒后盘口变化
```

### 批量初始化数据

```
10个交易对 × 6个月：
  • 交易数据生成: 30-50秒
  • K线数据生成: 30-40秒
  • 总耗时: 1-2分钟
  • 数据库增长: ~10MB

10个交易对 × 1年：
  • 交易数据生成: 60-100秒
  • K线数据生成: 60-80秒
  • 总耗时: 2-3分钟
  • 数据库增长: ~20MB
```

## ✅ 最佳实践

1. **首次启动**：
   - 先批量初始化数据（6个月）
   - 等待完成后再批量设置活跃度

2. **活跃度调整**：
   - 先用批量设置统一配置
   - 然后单独调整特殊币种
   - 观察10秒后效果

3. **数据维护**：
   - 不要频繁重复生成相同时间段
   - 定期清理超过1年的旧数据
   - 新币上线时单独初始化

4. **性能优化**：
   - 控制每个币种交易数在500-1000笔
   - 避免生成超过2年的数据
   - 使用合理的活跃度参数（5-7）

---

## 🎉 总结

两个批量功能让管理变得简单：

**🎮 批量设置活跃度**
- 一键配置所有币种活跃度
- 10秒内生效
- 随时调整

**🚀 批量初始化数据**
- 一键生成历史数据
- 后台队列执行
- 一次设置长期使用

现在你可以轻松管理 10、20 甚至 100 个交易对了！🚀

