# K线周期说明

## 支持的时间周期

### 秒级K线 ⚡
- **15s** - 15秒K线（超短线交易）
- **30s** - 30秒K线（短线交易）

### 分钟级K线 📊
- **1m** - 1分钟K线（短线）
- **3m** - 3分钟K线（短线）
- **5m** - 5分钟K线（常用）
- **15m** - 15分钟K线（常用）
- **30m** - 30分钟K线（中短线）

### 小时级K线 📈
- **1h** - 1小时K线（中线）
- **4h** - 4小时K线（中长线）

### 日级K线 📅
- **1d** - 日K线（长线）

## 前端显示

在交易页面的K线图上方，周期按钮分为三组：

```
秒: [15s] [30s]
分: [1m] [3m] [5m] [15m] [30m]
时: [1h] [4h] [1d]
```

点击任意按钮即可切换到对应周期。

## 后端生成

K线生成器会自动为所有周期生成K线数据：

```go
intervals: map[string]time.Duration{
    "15s": 15 * time.Second,
    "30s": 30 * time.Second,
    "1m":  1 * time.Minute,
    // ... 等等
}
```

### 生成频率

- **15s** - 每15秒生成一次
- **30s** - 每30秒生成一次
- **1m** - 每1分钟生成一次
- **5m** - 每5分钟生成一次
- **1h** - 每1小时生成一次
- **1d** - 每24小时生成一次

## 数据量估算

假设一个交易对运行24小时：

| 周期 | 每天生成 | 30天数据量 | 存储大小(估) |
|------|---------|-----------|------------|
| 15s | 5,760条 | 172,800条 | ~17MB |
| 30s | 2,880条 | 86,400条 | ~9MB |
| 1m | 1,440条 | 43,200条 | ~4MB |
| 5m | 288条 | 8,640条 | ~1MB |
| 1h | 24条 | 720条 | ~72KB |
| 1d | 1条 | 30条 | ~3KB |

**总计**: 约31MB/交易对/月

## 使用建议

### 超短线（秒级）
- **15s** - 刷单、套利
- **30s** - 快速进出

### 短线（分钟级）
- **1m** - 日内交易
- **3m** - 日内交易
- **5m** - 波段交易
- **15m** - 趋势确认

### 中线（小时级）
- **1h** - 趋势跟踪
- **4h** - 波段交易

### 长线（日级）
- **1d** - 长期投资

## 性能影响

### CPU 使用
秒级K线会增加 CPU 使用：
- 15s: 每秒约 0.33次计算（每个交易对）
- 30s: 每秒约 0.17次计算

对于 5个交易对：
- 总计算: ~2.5次/秒
- 影响: 可忽略

### 数据库写入
秒级K线会增加数据库写入频率：
- 15s: 每分钟 4次写入（每个交易对）
- 30s: 每分钟 2次写入

对于 5个交易对 × 10个周期：
- 总写入: ~300次/分钟
- SQLite 完全可以处理

### 内存使用
K线数据在内存中暂存，影响很小：
- 单条K线: ~200字节
- 100条K线: ~20KB
- 5个交易对 × 10周期 × 100条: ~1MB

## 优化建议

### 1. 限制历史数据
```go
// 只保留最近的数据
database.DB.Where("symbol = ? AND interval = ? AND open_time < ?", 
    symbol, interval, cutoffTime).Delete(&models.Kline{})
```

### 2. 定期清理
```bash
# 删除30天前的秒级数据
DELETE FROM klines 
WHERE interval IN ('15s', '30s') 
AND created_at < datetime('now', '-30 days');
```

### 3. 分表存储（可选）
将秒级、分钟级、小时级K线存储在不同表中。

## 前端使用

### 默认周期
```typescript
const [interval, setInterval] = useState('1m'); // 默认1分钟
```

### 切换周期
```typescript
<button onClick={() => setInterval('15s')}>15s</button>
<button onClick={() => setInterval('30s')}>30s</button>
```

### 图表自动更新
RTK Query 会自动根据 `pollingInterval` 刷新数据：

```typescript
const { data: klines } = useGetKlinesQuery(
  { symbol, interval },
  { pollingInterval: 10000 } // 10秒刷新
);
```

## 秒级K线的特点

### 优点
- ✅ 超高频交易者需要
- ✅ 捕捉瞬时波动
- ✅ 更精细的入场点

### 缺点
- ⚠️ 噪音较多
- ⚠️ 需要更多存储
- ⚠️ 数据更新频繁

## 实际应用

### 日内交易者
推荐使用：15s, 30s, 1m, 5m

### 波段交易者
推荐使用：15m, 30m, 1h, 4h

### 长线投资者
推荐使用：1h, 4h, 1d

## 监控和维护

### 查看秒级K线数据
```bash
sqlite3 backend/expchange.db

# 查看15秒K线数量
SELECT interval, COUNT(*) as count 
FROM klines 
WHERE interval = '15s' 
GROUP BY interval;

# 查看最新的秒级K线
SELECT * FROM klines 
WHERE interval IN ('15s', '30s') 
ORDER BY created_at DESC 
LIMIT 10;
```

### 数据库大小
```bash
ls -lh backend/expchange.db
```

如果数据库太大，定期清理旧数据。

## 配置推荐

### 开发环境
启用所有周期，包括秒级。

### 生产环境
根据用户需求决定：
- 普通用户: 1m, 5m, 15m, 1h, 1d
- 高级用户: 增加 15s, 30s
- 专业交易员: 全部周期

## 示例场景

### 场景1: 刷单交易
```
15s K线 → 发现瞬时价格差 → 快速下单 → 15s内完成
```

### 场景2: 趋势确认
```
1h K线 → 看大趋势
15m K线 → 确认中期趋势
1m K线 → 寻找入场点
15s K线 → 精确入场
```

## 注意事项

⚠️ **秒级K线需要足够的成交记录**
- 如果没有交易，秒级K线会使用上一根的收盘价
- 建议启用市场模拟器产生足够的成交数据

⚠️ **轮询间隔建议**
- 15s K线: 每5秒刷新
- 30s K线: 每10秒刷新
- 分钟级: 每10-30秒刷新

⚠️ **存储清理**
建议定期清理超过30天的秒级K线数据。

## 测试

启用市场模拟器后：
```bash
cd backend
# 确保 .env 中有
# ENABLE_SIMULATOR=true
go run main.go
```

然后访问交易页面，切换到 15s 或 30s，应该能看到：
- K线每15秒或30秒更新一次
- 图表平滑过渡
- 数据实时刷新

现在你可以看到秒级K线了！🚀


