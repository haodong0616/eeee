# 虚拟用户说明

## 什么是虚拟用户？

虚拟用户是系统自动创建的特殊账户（钱包地址：`0x0000000000000000000000000000000000000000`），用于：

1. **订单簿模拟器**：自动在盘口挂买卖单，提供流动性
2. **测试数据**：生成历史交易记录和K线数据

## 虚拟用户的订单

### 在哪里能看到？
- ✅ **盘口深度**：能看到虚拟用户的挂单（买盘/卖盘）
- ❌ **我的订单**：不会显示（已过滤）

### 我能取消虚拟订单吗？
**不能！** 虚拟订单只能被系统自动管理，真实用户无法操作。

## 如何识别虚拟订单？

虚拟订单的特征：
- 在盘口深度中显示（买盘/卖盘）
- 不出现在"我的订单"列表中
- 由系统自动创建和管理
- 提供市场流动性

## 为什么需要虚拟用户？

### 1. 演示模式
新建的交易所没有真实用户时，虚拟用户提供：
- 盘口买卖单（可以立即成交）
- 市场深度
- 真实的交易体验

### 2. 数据初始化
生成历史数据时，虚拟用户参与交易：
- 创建历史成交记录
- 生成K线数据
- 模拟市场活动

## 启用/禁用虚拟交易

### 启用（默认）
```bash
cd backend
echo "ENABLE_SIMULATOR=true" >> .env
go run main.go
```

### 禁用
```bash
cd backend
echo "ENABLE_SIMULATOR=false" > .env
go run main.go
```

禁用后：
- ❌ 盘口不会有自动挂单
- ❌ 价格不会自动波动
- ✅ 只有真实用户的订单
- ✅ 适合生产环境

## 常见问题

### Q: 我的订单列表为什么是空的？
A: 这是正常的！如果你还没有下过单，列表就是空的。盘口中显示的是虚拟用户的订单。

### Q: 为什么不能取消盘口中的订单？
A: 盘口中的订单可能是虚拟用户的订单，只有你自己创建的订单才能取消。

### Q: 如何创建我自己的订单？
A: 
1. 连接钱包并登录
2. 充值资金（在"资产"页面）
3. 在交易页面填写订单表单
4. 点击"买入"或"卖出"

### Q: 虚拟订单会被成交吗？
A: 会！如果你的订单价格匹配虚拟订单的价格，就会立即成交。

## 技术细节

### 虚拟用户ID
```go
// 后端代码
virtualUser := models.User{
    WalletAddress: "0x0000000000000000000000000000000000000000",
    Nonce:        "virtual",
    UserLevel:    "normal",
}
```

### 订单过滤
```typescript
// 前端代码 - MyOrders.tsx
const userOrders = orders.filter(order => 
  order.user_id !== 0 && 
  order.user_id !== undefined
);
```

### 订单簿模拟器
- 每10秒检查并维护订单簿
- 自动创建买卖单维持市场深度
- 价格基于最近成交价±0.5-2%

## 最佳实践

### 演示/开发环境
```bash
ENABLE_SIMULATOR=true
```
- ✅ 有盘口流动性
- ✅ 可以立即成交
- ✅ 适合测试

### 生产环境
```bash
ENABLE_SIMULATOR=false
```
- ✅ 纯真实交易
- ✅ 无虚拟订单
- ✅ 依赖真实用户挂单

